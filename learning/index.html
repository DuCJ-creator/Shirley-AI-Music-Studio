<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI å­¸ç¿’ã€Œæ¨‚ã€ğŸµåœ’ | Learn Grammar with AI Songs</title>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Cormorant+Garamond:wght@500;600&display=swap" rel="stylesheet">

  <style>
    /* ... ä¿æŒæ‰€æœ‰ç¾æœ‰çš„ CSS Styles ... */
    /* ---------------------------------- */
    /* 1) Tokens â€” Deep Burgundy + Blue Velvet Sky */
    /* ---------------------------------- */
    :root{
      --burg-0:#f7e9ee;
      --burg-1:#d8a1ad;
      --burg-2:#a63b55;
      --burg-3:#7a1632;
      --burg-4:#4e0b1f;
      --burg-5:#24040e;

      --gold-0:#fff3c8;
      --gold-1:#ffd36b;
      --gold-2:#ffb400;

      --ivory:#fff7fb;
      --ink:#120915;

      --bg-0:#050814;
      --bg-1:#08162d;
      --bg-2:#0a2342;
      --bg-3:#0b2e52;
      --bg-4:#11264a;

      --font-ui:"Orbitron", system-ui, sans-serif;
      --font-serif:"Cormorant Garamond", serif;

      /* ä¿®æ”¹ï¼šä½¿ç”¨æ›´éˆæ´»çš„å®¹å™¨å°ºå¯¸è¨ˆç®— */
      --container-size: min(90vh, min(85vw, 650px));
      --petal-w: clamp(120px, 14vw, 190px);
      --petal-h: clamp(160px, 20vw, 260px);
      --center-size: clamp(85px, 10vw, 130px);
      --lift: clamp(25px, 5vw, 65px);

      --title-bottom-gap: clamp(6px, 1.2vh, 10px);
      --nav-bottom-gap: clamp(8px, 1.6vh, 14px);
      --page-padding: clamp(10px, 2vw, 18px);
    }

    html, body { height: 100%; }
    * { box-sizing: border-box; }

   body{
  margin:0;
  min-height:100vh;
  
  /* âœ… æ”¹æˆæ­£å¸¸ç›´å‘æ’ç‰ˆï¼šå¾ä¸Šåˆ°ä¸‹ */
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;

  padding: var(--page-padding);
  font-family:var(--font-ui);
  color:var(--ivory);
  background:
    radial-gradient(1200px 820px at 50% 28%, var(--bg-4) 0%, var(--bg-3) 26%, var(--bg-2) 55%, var(--bg-1) 78%, var(--bg-0) 100%);

  /* âœ… åªé–æ°´å¹³ï¼Œé–‹æ”¾å‚ç›´æ²å‹• */
  overflow-x:hidden;
  overflow-y:auto;

  position:relative;
  letter-spacing:.02em;
}

    /* ---------------------------------- */
    /* 2) Starfield + Nebula + Floating Sparks */
    /* é‡æ–°èª¿æ•´ z-indexï¼Œè®“ three.js æ˜Ÿç³»åœ¨ä¸­é–“å±¤ */
    /* ---------------------------------- */
    body::before{
      content:"";
      position:absolute; inset:-12%;
      background:
        radial-gradient(1.2px 1.2px at 6% 12%, rgba(255,255,255,.95) 0 70%, transparent 72%),
        radial-gradient(1.4px 1.4px at 22% 38%, rgba(255,255,255,.9) 0 70%, transparent 72%),
        radial-gradient(1.2px 1.2px at 44% 18%, rgba(255,255,255,.95) 0 70%, transparent 72%),
        radial-gradient(1.6px 1.6px at 72% 22%, rgba(255,255,255,.95) 0 70%, transparent 72%),
        radial-gradient(1.3px 1.3px at 82% 66%, rgba(255,255,255,.92) 0 70%, transparent 72%),
        radial-gradient(1.5px 1.5px at 16% 78%, rgba(255,255,255,.97) 0 70%, transparent 72%),
        radial-gradient(1.2px 1.2px at 58% 84%, rgba(255,255,255,.9) 0 70%, transparent 72%),
        radial-gradient(1.4px 1.4px at 90% 38%, rgba(255,255,255,.94) 0 70%, transparent 72%),

        radial-gradient(0.9px 0.9px at 10% 20%, rgba(255,255,255,.7) 0 70%, transparent 72%),
        radial-gradient(0.8px 0.8px at 30% 60%, rgba(255,255,255,.6) 0 70%, transparent 72%),
        radial-gradient(0.9px 0.9px at 55% 42%, rgba(255,255,255,.65) 0 70%, transparent 72%),
        radial-gradient(0.8px 0.8px at 70% 74%, rgba(255,255,255,.6) 0 70%, transparent 72%),
        radial-gradient(0.9px 0.9px at 86% 12%, rgba(255,255,255,.7) 0 70%, transparent 72%),
        radial-gradient(0.8px 0.8px at 48% 12%, rgba(255,255,255,.55) 0 70%, transparent 72%),
        radial-gradient(0.9px 0.9px at 14% 88%, rgba(255,255,255,.6) 0 70%, transparent 72%),
        radial-gradient(0.8px 0.8px at 94% 84%, rgba(255,255,255,.55) 0 70%, transparent 72%);
      opacity:.75;
      filter: blur(.15px);
      animation: starDrift 34s linear infinite;
      z-index:-5;
    }
    @keyframes starDrift{ to{ transform: translateY(3%) translateX(-1.5%); } }

    body::after{
      content:"";
      position:absolute; inset:-22%;
      background:
        radial-gradient(980px 720px at 28% 30%, rgba(62,126,255,.12), transparent 62%),
        radial-gradient(980px 760px at 72% 20%, rgba(35,98,220,.10), transparent 66%),
        radial-gradient(1000px 780px at 50% 72%, rgba(255,211,107,.06), transparent 60%);
      animation: nebulaBreathe 10s ease-in-out infinite;
      z-index:-4;
    }
    @keyframes nebulaBreathe{
      0%,100%{opacity:.5; transform:scale(1);}
      50%{opacity:.85; transform:scale(1.03);}
    }

    /* three.js æ˜Ÿç³»èƒŒæ™¯ canvas */
    #stars-bg{
      position:fixed;
      inset:0;
      /* ç§»é™¤ pointer-events:noneï¼Œè®“æ»‘é¼ æ»¾è¼ªäº‹ä»¶å¯ä»¥è¢« window æ•æ‰ */
      z-index:-3;
      display:block;
    }

    .spark-field{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:-2;
      overflow:hidden;
    }
    .spark{
      position:absolute;
      width:140px; height:2px;
      background: linear-gradient(90deg, transparent, rgba(255,211,107,.95), transparent);
      filter: blur(0.4px);
      opacity:.55;
      transform: rotate(12deg);
      animation: sparkMove linear infinite;
    }
    @keyframes sparkMove{
      0%{ transform: translateX(-25vw) translateY(0) rotate(12deg); opacity:0; }
      10%{ opacity:.8; }
      100%{ transform: translateX(125vw) translateY(-34vh) rotate(12deg); opacity:0; }
    }

    /* ---------------------------------- */
    /* 3) Title */
    /* === è¶…ä¸»é¡Œæ€§æ¨™é¡Œï¼šæ¼¸å±¤ç™¼å…‰ + è—è¡“æ„Ÿç‰¹æ•ˆ === */
#page-title{
  position: relative;
  margin-bottom: 14px;               /* è·Ÿ Knowledge Map ä¿æŒä¸€é»å‘¼å¸ç©ºé–“ */
  text-align: center;
  font-family: var(--font-serif);
  font-weight: 600;
  font-size: clamp(2.6rem, 4.3vw, 3.6rem);  /* æ•´é«”æ”¾å¤§ï¼šæ¡Œæ©Ÿæ›´åƒä¸»è¦–è¦ºæ¨™é¡Œ */
  letter-spacing: 0.22em;
  text-transform: uppercase;

  /* é‡‘ç²‰æ¼¸å±¤æ–‡å­— */
  background: linear-gradient(
    120deg,
    #fff7fb 0%,
    #ffe9b8 28%,
    #ffd36b 50%,
    #ffb400 65%,
    #f7e9ee 100%
  );
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;

  /* å¤–åœˆæŸ”å…‰ */
  text-shadow:
    0 0 24px rgba(255,243,200,0.9),
    0 0 60px rgba(166,59,85,0.55);

  /* æ…¢é€Ÿå‘¼å¸å…‰æ•ˆ */
  animation: titleGlow 7s ease-in-out infinite;
}

/* æ¨™é¡Œåº•ä¸‹åŠ ä¸€é“ç™¼å…‰çš„ç´°ç·šï¼Œæ‹‰å‡ºä¸»è¦–è¦ºæ„Ÿ */
#page-title::after{
  content:"";
  position:absolute;
  left:50%;
  bottom:-10px;
  width: clamp(140px, 32vw, 260px);
  height: 2px;
  transform: translateX(-50%);
  background:
    radial-gradient(circle at 0% 50%, rgba(255,243,200,0) 0, rgba(255,243,200,0.9) 40%, transparent 70%),
    linear-gradient(90deg, rgba(255,243,200,0) 0%, rgba(255,211,107,0.9) 50%, rgba(255,243,200,0) 100%);
  box-shadow:
    0 0 12px rgba(255,243,200,0.9),
    0 0 22px rgba(166,59,85,0.6);
}

/* å‰¯æ¨™ï¼šæ”¾å¤§ï¼‹è¼•å¾®é–ƒçˆæ„Ÿ */
#page-title small{
  display:block;
  margin-top: 8px;
  font-family: var(--font-ui);
  font-size: clamp(1.05rem, 1.5vw, 1.25rem);
  letter-spacing: 0.18em;
  color: rgba(255,247,251,0.96);
  text-shadow:
    0 0 12px rgba(255,243,200,0.8),
    0 0 30px rgba(60,120,250,0.6);
  animation: subtitleShimmer 5.5s ease-in-out infinite;
}

/* ä¸»æ¨™å…‰æ•ˆï¼šæ…¢æ…¢äº®èµ·åˆæš—ä¸‹å» */
@keyframes titleGlow{
  0%, 100%{
    text-shadow:
      0 0 18px rgba(255,243,200,0.7),
      0 0 40px rgba(166,59,85,0.4);
    transform: translateY(0);
  }
  45%{
    text-shadow:
      0 0 28px rgba(255,243,200,1),
      0 0 80px rgba(166,59,85,0.7);
    transform: translateY(-2px);
  }
}

/* å‰¯æ¨™ç´°ç·»ä¸€é»çš„é–ƒå‹• */
@keyframes subtitleShimmer{
  0%, 100%{
    opacity: 0.9;
    letter-spacing: 0.16em;
  }
  40%{
    opacity: 1;
    letter-spacing: 0.2em;
  }
}
    /* ---------------------------------- */
    /* 4) Navigation Panel */
    /* ---------------------------------- */
    #nav-panel{
      width:min(92vw, 720px);
      margin:0 0 var(--nav-bottom-gap) 0;
      padding:clamp(10px, 1.8vw, 16px);
      border-radius:16px;
      position:relative;
      z-index:4;
      background:
        linear-gradient(180deg, rgba(8,12,24,.7), rgba(5,8,16,.85));
      border:1px solid rgba(255,243,200,.5);
      box-shadow:
        0 8px 26px rgba(0,0,0,.55),
        0 0 22px rgba(255,211,107,.3),
        inset 0 0 18px rgba(166,59,85,.18);
      backdrop-filter: blur(10px) saturate(1.05);
    }
    #nav-panel::before{
      content:"";
      position:absolute; inset:-1px;
      border-radius:16px;
      background:
        radial-gradient(120% 140% at 10% 0%, rgba(255,211,107,.16), transparent 55%),
        radial-gradient(110% 140% at 90% 100%, rgba(60,120,250,.18), transparent 60%);
      pointer-events:none;
      mix-blend-mode: screen;
    }

    .nav-title{
      font-family:var(--font-ui);
      font-weight:700;
      letter-spacing:.16em;
      font-size:clamp(.9rem, 1.3vw, 1.05rem);
      color:var(--gold-0);
      opacity:.95;
      text-shadow:0 0 10px rgba(255,211,107,.55);
      margin:0 0 8px 0;
      text-align:center;
      cursor: pointer;
    }

    .nav-grid{
      display:grid;
      gap:8px 12px;
      grid-template-columns: 1fr 1fr;
    }
    .nav-item{
      padding:8px 10px;
      border-radius:10px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      color:var(--ivory);
      font-size:clamp(.88rem, 1.2vw, .98rem);
      line-height:1.35;
      text-shadow:
        0 1px 3px rgba(0,0,0,.9),
        0 0 8px rgba(166,59,85,.35);
      transition: transform .35s ease, box-shadow .35s ease, border-color .35s ease;
      cursor:pointer;
    }
    .nav-item strong{
      color:#fff;
      font-weight:800;
      letter-spacing:.04em;
    }
    .nav-item.full{
      grid-column: 1 / -1;
      text-align:center;
      background:
        linear-gradient(180deg, rgba(255,211,107,.08), rgba(166,59,85,.08)),
        rgba(255,255,255,.05);
      border-color: rgba(255,211,107,.35);
      box-shadow:
        0 0 12px rgba(255,211,107,.3),
        inset 0 0 14px rgba(166,59,85,.18);
    }
    .nav-item:hover{
      transform: translateY(-2px);
      border-color: rgba(255,211,107,.35);
      box-shadow: 0 6px 16px rgba(0,0,0,.5), 0 0 10px rgba(255,211,107,.25);
    }
/* === å£“ç¸®å‚ç›´é–“è·ï¼šæ¨™é¡Œ â†” å°èˆª â†” èŠ±æœµ â†” è¿”å›ä¸»é  === */

/* æ¨™é¡Œè·Ÿå°èˆªé è¿‘ä¸€é» */
#page-title{
  margin-bottom: 14px;   /* åŸæœ¬æ¯”è¼ƒå¤§ï¼Œæ”¹æˆ 4px */
}

/* å°èˆªè·ŸèŠ±æœµé è¿‘ä¸€é» */
#nav-panel{
  margin-bottom: 8px;   /* åŸæœ¬ç”¨è®Šæ•¸ï¼Œé€™è£¡ç›´æ¥æ”¶ç·Š */
}

/* èŠ±æœµæœ¬èº«ä¸Šä¸‹éƒ½ç¸®å° */
#flower-rotator{
  margin-top: 4px;
  margin-bottom: 4px;
}

/* èŠ±æœµå’Œã€Œè¿”å›ä¸»é ã€ä¹‹é–“ä¹Ÿç¸®å° */
#back-button{
  margin-top: 6px;      /* åŸæœ¬æœ€å¤šæœƒåˆ° 24pxï¼Œæ”¹æˆ 6px å°±å¥½ */
}
    /* ---------------------------------- */
    /* 5) Flower motion wrapper */
    /* ---------------------------------- */
    #flower-rotator{
      width:var(--container-size);
      height:var(--container-size);
      display:grid;
      place-items:center;
      position:relative;
      z-index:3;
      /* âœ… ç¢ºä¿èŠ±æœµåœ¨è¦–çª—å…§ */
      max-width: 95vw;
      max-height: 70vh;
      /* âœ… åŸæœ¬æœ‰æ—‹è½‰èˆ‡æµ®å‹•å‹•ç•«ï¼Œå·²ç§»é™¤ï¼Œæ”¹ç‚ºéœæ­¢ */
      /* animation:
        flowerSpin 90s linear infinite,
        flowerFloat 9s ease-in-out infinite; */
      transform-origin:center center;
      filter: drop-shadow(0 16px 48px rgba(0,0,0,.7));
    }

    /* ä¿ç•™ keyframesï¼ˆä»¥å¾Œéœ€è¦å¯ä»¥å†ç”¨ï¼‰
    @keyframes flowerSpin{
      from{ transform: rotate(0deg); }
      to{ transform: rotate(360deg); }
    }
    @keyframes flowerFloat{
      0%,100%{ translate: 0 0; }
      50%{ translate: 0 -8px; }
    } */

    /* ---------------------------------- */
    /* 6) Flower container */
    /* ---------------------------------- */
    #petal-container{
      width:100%;
      height:100%;
      position:relative;
      display:grid;
      place-items:center;

      /* åŸæœ¬æœ‰è„ˆå‹•å‹•ç•«ï¼Œæ”¹ç‚ºéœæ­¢ */
      /* animation: slowPulse 12s ease-in-out infinite; */
    }

    /*@keyframes slowPulse{
      0%,100%{transform:scale(1);}
      50%{transform:scale(1.02);}
    }*/

    /* ---------------------------------- */
    /* 7) Center core */
    /* ---------------------------------- */
    #learning-center{
      position:absolute;
      width:var(--center-size);
      height:var(--center-size);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      line-height:1.15;

      background:
        radial-gradient(circle at 38% 32%,
          var(--burg-0) 0%,
          var(--burg-1) 32%,
          var(--burg-2) 60%,
          var(--burg-3) 100%);
      border:1.5px solid rgba(247,233,238,.95);
      box-shadow:
        0 0 22px rgba(166,59,85,.9),
        0 0 16px rgba(255,211,107,.7),
        inset 0 0 10px rgba(247,233,238,1);

      font-size:clamp(.95rem, 2.1vw, 1.15rem);
      font-weight:800;
      letter-spacing:.08em;
      color:var(--ink);
      text-shadow:
        0 1px 0 rgba(247,233,238,1),
        0 0 8px rgba(255,211,107,.9);

      z-index:30;
      /* åŸæœ¬æœ‰ centerBreatheï¼Œæ”¹ç‚ºéœæ­¢ */
      /* animation: centerBreathe 6s ease-in-out infinite; */
    }

    /*@keyframes centerBreathe{
      0%,100%{transform:scale(1);}
      50%{transform:scale(1.06);}
    }*/

    /* ---------------------------------- */
    /* 8) Petals â€” Deep Burgundy Velvet */
    /* ---------------------------------- */
    .petal{
      --angle:0deg;
      --tilt:0deg;
      position:absolute;
      width:var(--petal-w);
      height:var(--petal-h);
      transform-origin:center bottom;

      clip-path: polygon(
        50% 0%,
        67% 4%,
        82% 14%,
        92% 28%,
        96% 44%,
        90% 62%,
        78% 78%,
        62% 90%,
        54% 96%,
        50% 100%,
        46% 96%,
        38% 90%,
        22% 78%,
        10% 62%,
        4% 44%,
        8% 28%,
        18% 14%,
        33% 4%
      );

      transform:
        rotate(var(--angle))
        translateY(calc(var(--lift) * -1))
        rotate(var(--tilt));

      background:
        radial-gradient(120% 140% at 50% 0%,
          var(--burg-0) 0%,
          var(--burg-1) 15%,
          var(--burg-2) 36%,
          var(--burg-3) 65%,
          var(--burg-4) 100%),
        linear-gradient(165deg,
          rgba(247,233,238,1),
          rgba(122,22,50,.95) 48%,
          rgba(78,11,31,1) 100%);

      border:1px solid rgba(247,233,238,.85);
      backdrop-filter: blur(7px) saturate(1.12);

      box-shadow:
        inset 0 14px 34px rgba(247,233,238,1),
        inset 0 -34px 62px rgba(36,4,14,.95),
        0 10px 28px rgba(0,0,0,.6),
        0 0 14px rgba(255,211,107,.28);
      filter: drop-shadow(0 0 7px rgba(166,59,85,1));

      display:grid;
      place-items:center;
      text-decoration:none;
      text-align:center;
      padding:12px;
      line-height:1.45;

      color:var(--ivory);
      font-size:clamp(.86rem, 1.1vw, 1rem);
      font-weight:700;
      letter-spacing:.03em;

      text-shadow:
        0 2px 6px rgba(0,0,0,.9),
        0 0 10px rgba(255,211,107,.22);

      transition:
        transform .45s cubic-bezier(.2,.8,.2,1),
        box-shadow .45s ease,
        filter .45s ease,
        background .45s ease;

      /* åŸæœ¬æœ‰ petalBreathe + petalSwayï¼Œé€™è£¡æ”¹æˆé è¨­ä¸å‹• */
      /* animation:
        petalBreathe 7.2s ease-in-out infinite,
        petalSway 5.5s ease-in-out infinite; */
      z-index:2;
      cursor:pointer;
      isolation:isolate;
    }

    .petal::after{
      content:"";
      position:absolute;
      inset:15% 11%;
      border-radius:16px;
      background: rgba(10,3,6,.38);
      filter: blur(11px);
      z-index:-1;
    }

    .petal::before{
      content:"";
      position:absolute; inset:0;
      clip-path: inherit;
      background:
        radial-gradient(120% 140% at 50% 0%,
          rgba(247,233,238,.55),
          transparent 55%),
        repeating-radial-gradient(circle at 50% 8%,
          rgba(247,233,238,.18) 0 8px,
          rgba(247,233,238,0) 8px 18px);
      opacity:.24;
      mix-blend-mode: soft-light;
      pointer-events:none;
    }
/* nav é»æ“Šæ™‚ç”¨çš„ã€Œsparkling + æŒçºŒè·³å‹•ã€æ•ˆæœ */
/* nav é»æ“Šæ™‚ç”¨çš„ã€Œä¹¾æ·¨ç‰ˆ sparkling + å½ˆè·³ã€ */
.petal.nav-highlight{
  animation:
    petalNavBounce 0.9s ease-in-out infinite,
    petalGlow 1.4s ease-in-out infinite;
  z-index: 12;
}

/* æŸ”å’Œçš„é‡‘è‰²å…‰æšˆï¼ˆå–ä»£æ»¿ç‰ˆåœ“é»ï¼‰ */
.petal.nav-highlight::before{
  opacity: 1;
  background:
    radial-gradient(130% 170% at 50% 0%,
      rgba(255,243,220,0.95) 0%,
      rgba(255,211,107,0.45) 32%,
      rgba(166,59,85,0.0) 62%);
  mix-blend-mode: screen;
  filter: blur(2px);
  animation: petalHalo 1.4s ease-in-out infinite;
}

/* ä¸€é“æ–œå‘æƒéå»çš„äº®å…‰ï¼Œç‡Ÿé€  sparkling æ„Ÿ */
.petal.nav-highlight::after{
  content:"";
  position:absolute;
  inset:-30%;
  clip-path: inherit;
  background:
    linear-gradient(120deg,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,0.95) 45%,
      rgba(255,255,255,0) 80%);
  mix-blend-mode: screen;
  opacity:0;
  transform: translateX(-120%) rotate(8deg);
  animation: shimmerSweep 1.8s linear infinite;
}

/* èŠ±ç“£æœ¬é«”å½ˆè·³ï¼ˆé£›å‡ºå»åˆå›ä¾†ï¼‰ */
@keyframes petalNavBounce{
  0%{
    transform:
      rotate(var(--angle))
      translateY(calc(var(--lift) * -1))
      rotate(var(--tilt))
      scale(1);
  }
  50%{
    transform:
      rotate(var(--angle))
      translateY(calc(var(--lift) * -1 - 50px))
      rotate(var(--tilt))
      scale(1.18);
  }
  100%{
    transform:
      rotate(var(--angle))
      translateY(calc(var(--lift) * -1 - 10px))
      rotate(var(--tilt))
      scale(1.06);
  }
}

/* å…‰æšˆä¸€æ˜ä¸€æš—ï¼ˆæ›´æœ‰ç«‹é«”æ„Ÿï¼‰ */
@keyframes petalGlow{
  0%{
    box-shadow:
      inset 0 16px 38px rgba(247,233,238,0.9),
      inset 0 -38px 64px rgba(20,2,7,1),
      0 12px 32px rgba(0,0,0,.7),
      0 0 18px rgba(255,211,107,.6);
    filter: drop-shadow(0 0 10px rgba(255,211,107,.8));
  }
  50%{
    box-shadow:
      inset 0 28px 80px rgba(247,233,238,1),
      inset 0 -80px 120px rgba(10,0,4,1),
      0 24px 70px rgba(0,0,0,.95),
      0 0 34px rgba(255,243,200,1),
      0 0 60px rgba(255,211,107,1);
    filter: drop-shadow(0 0 26px rgba(255,243,200,1));
  }
  100%{
    box-shadow:
      inset 0 20px 48px rgba(247,233,238,1),
      inset 0 -48px 80px rgba(20,2,7,1),
      0 18px 45px rgba(0,0,0,.8),
      0 0 22px rgba(255,211,107,.8);
    filter: drop-shadow(0 0 16px rgba(255,211,107,.9));
  }
}

/* å…‰æšˆæœ¬èº«çš„è¼•å¾®å‘¼å¸æ„Ÿ */
@keyframes petalHalo{
  0%  { opacity: .65; transform: scale(0.98); }
  50% { opacity: 1;   transform: scale(1.05); }
  100%{ opacity: .7;  transform: scale(1.0); }
}

/* æ–œå‘äº®å…‰æƒéå»ï¼Œè£½é€ ä¹¾æ·¨çš„ sparkle æ„Ÿ */
@keyframes shimmerSweep{
  0%{
    transform: translateX(-130%) rotate(8deg);
    opacity: 0;
  }
  25%{
    opacity: 0.95;
  }
  60%{
    opacity: 0.9;
  }
  100%{
    transform: translateX(130%) rotate(8deg);
    opacity: 0;
  }
}




    .petal:hover,
    .petal:focus-visible{
      transform:
        rotate(var(--angle))
        translateY(calc(var(--lift) * -1 - 10px))
        rotate(var(--tilt))
        scale(1.05);

      box-shadow:
        inset 0 18px 42px rgba(247,233,238,1),
        inset 0 -42px 74px rgba(20,2,7,1),
        0 16px 40px rgba(0,0,0,.7),
        0 0 22px rgba(255,211,107,.85);

      filter: drop-shadow(0 0 12px rgba(255,211,107,1));
      outline:none;
      z-index:8;
    }

    .petal .petal-content{
      transform: rotate(calc(var(--angle) * -1)) rotate(calc(var(--tilt) * -1));
      max-width:82%;
    }

    .petal.layer-a{ z-index:3; }
    .petal.layer-b{ z-index:2; }

    /* ---------------------------------- */
    /* 9) Back Button */
    /* ---------------------------------- */
    #back-button{
      margin-top: clamp(12px, 2.2vh, 24px);
      background: linear-gradient(180deg, var(--gold-0), var(--gold-1));
      color:#2a0f1e;
      border:1px solid rgba(255,241,200,.95);
      padding: 10px 18px;
      font-size: clamp(.95rem, 1.8vw, 1.12rem);
      font-weight:800;
      font-family:var(--font-ui);
      letter-spacing:.08em;
      border-radius: 12px;
      cursor:pointer;
      box-shadow:
        0 8px 24px rgba(0,0,0,.6),
        0 0 16px rgba(255,211,107,1);
      transition:.25s ease;
      z-index:5;
    }
    #back-button:hover{
      transform: translateY(-1px) scale(1.04);
      box-shadow:
        0 12px 32px rgba(0,0,0,.7),
        0 0 22px rgba(255,211,107,1);
    }

    /* ---------------------------------- */
    /* 10) Golden trail canvas */
    /* ---------------------------------- */
    #trail-canvas{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:999;
      mix-blend-mode: screen;
    }
    
    /* ---------------------------------- */
    /* 12) æ–°å¢çš„éŸ³æ¨‚æ§åˆ¶æŒ‰éˆ•æ¨£å¼ */
    /* ---------------------------------- */
    #audio-control{
      position: fixed; /* å›ºå®šåœ¨è¢å¹•ä¸Š */
      top: var(--page-padding); /* è·é›¢é ‚éƒ¨é‚Šè· */
      right: var(--page-padding); /* è·é›¢å³å´é‚Šè· */
      width: clamp(36px, 6vw, 44px);
      height: clamp(36px, 6vw, 44px);
      border: 1px solid var(--gold-1);
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.4);
      color: var(--gold-1);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 8px var(--gold-1);
      transition: background 0.3s ease, box-shadow 0.3s ease;
      z-index: 9; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
      font-size: clamp(1.2rem, 2.5vw, 1.6rem);
      font-family: 'Times New Roman', serif; /* ç”¨ä¾†é¡¯ç¤ºğŸµåœ–ç¤º */
    }
    #audio-control:hover{
      background: rgba(255, 211, 107, 0.1);
      box-shadow: 0 0 12px var(--gold-1);
    }

    /* ---------------------------------- */
    /* 13) æ•ˆèƒ½æ§åˆ¶æŒ‰éˆ• */
    /* ---------------------------------- */
    #performance-control{
      position: fixed;
      bottom: var(--page-padding);
      right: var(--page-padding);
      width: clamp(36px, 6vw, 44px);
      height: clamp(36px, 6vw, 44px);
      border: 1px solid var(--burg-2);
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.4);
      color: var(--burg-2);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 9;
      font-size: clamp(1.2rem, 2.5vw, 1.6rem);
      box-shadow: 0 0 8px rgba(166, 59, 85, 0.5);
    }
    #performance-control:hover{
      background: rgba(166, 59, 85, 0.1);
      box-shadow: 0 0 12px rgba(166, 59, 85, 0.7);
    }

    /* ---------------------------------- */
    /* 11) Device breakpoints */
    /* ---------------------------------- */
    @media (max-width: 1024px){
      :root{
        --container-size:min(90vh, min(90vw, 600px));
        --petal-w:clamp(110px, 16vw, 180px);
        --petal-h:clamp(150px, 22vw, 240px);
        --center-size:clamp(75px, 9vw, 120px);
        --lift:clamp(20px, 4vw, 60px);
        --title-bottom-gap: clamp(6px, 1.2vh, 10px);
        --nav-bottom-gap: clamp(8px, 1.6vh, 12px);
      }
    }

    @media (max-width: 768px){
      :root{
        --container-size:min(85vh, min(95vw, 550px));
        --petal-w:clamp(100px, 18vw, 160px);
        --petal-h:clamp(140px, 25vw, 220px);
        --center-size:clamp(70px, 10vw, 110px);
        --lift:clamp(18px, 4vw, 50px);
      }
      
      #page-title {
        font-size: clamp(2.2rem, 6vw, 3rem);
      }
      
      #flower-rotator {
        max-height: 65vh;
      }
    }

    @media (max-width: 600px){
      :root{
        --container-size:min(80vh, min(98vw, 480px));
        --petal-w:clamp(90px, 22vw, 140px);
        --petal-h:clamp(120px, 30vw, 200px);
        --center-size:clamp(60px, 12vw, 100px);
        --lift:clamp(15px, 4vw, 40px);
      }
      
      #nav-panel{ 
        width:96vw; 
        padding:10px; 
      }
      
      .nav-grid{ 
        grid-template-columns:1fr; 
        gap:8px; 
      }
      
      .nav-item.full{ 
        grid-column:auto; 
      }
      
      #flower-rotator {
        max-height: 60vh;
      }
    }

    @media (max-width: 480px){
      :root{
        --container-size:min(75vh, min(98vw, 420px));
        --petal-w:clamp(80px, 26vw, 120px);
        --petal-h:clamp(110px, 35vw, 180px);
        --center-size:clamp(55px, 14vw, 90px);
        --lift:clamp(12px, 4vw, 35px);
      }
      
      #page-title {
        font-size: clamp(1.8rem, 7vw, 2.5rem);
        margin-bottom: 10px;
      }
      
      #flower-rotator {
        max-height: 55vh;
        margin-top: 2px;
        margin-bottom: 2px;
      }
    }

    @media (max-width: 380px){
      :root{
        --container-size:min(70vh, min(98vw, 380px));
        --petal-w:clamp(70px, 28vw, 110px);
        --petal-h:clamp(100px, 38vw, 160px);
        --center-size:clamp(50px, 16vw, 80px);
        --lift:clamp(10px, 4vw, 30px);
      }
      
      #flower-rotator {
        max-height: 50vh;
      }
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
    }
  </style>
</head>

<body>
  <audio id="bgm" loop preload="auto" src="https://ducj-creator.github.io/Shirley-AI-Music-Studio/assets/learning%20bg.mp3"></audio>

  <div id="audio-control" aria-label="éŸ³æ¨‚æ§åˆ¶">
    ğŸµ
  </div>

  <div id="performance-control" aria-label="æ•ˆèƒ½æ§åˆ¶">
    âš¡
  </div>

  <div class="spark-field" aria-hidden="true">
    <div class="spark" style="top:12%; left:-10%; animation-duration:14s; animation-delay:-2s;"></div>
    <div class="spark" style="top:30%; left:-20%; animation-duration:18s; animation-delay:-6s; opacity:.45;"></div>
    <div class="spark" style="top:56%; left:-15%; animation-duration:16s; animation-delay:-9s;"></div>
    <div class="spark" style="top:74%; left:-30%; animation-duration:20s; animation-delay:-12s; opacity:.35;"></div>
  </div>

  <canvas id="trail-canvas"></canvas>

  <h1 id="page-title">
    AI å­¸ç¿’ã€Œæ¨‚ã€ğŸµåœ’ | 
    <small>Learn Grammar with AI Songs</small>
  </h1>

  <section id="nav-panel" aria-label="èŠ±åœ’å°è¦½ï¼ˆçŸ¥è­˜åœ°åœ–ï¼‰">
   <h2 class="nav-title">
  Knowledge Map Â· æ–‡æ³•èŠ±åœ’å°è¦½
  <small style="display:block;font-size:.75em;opacity:.8;">
    ï¼ˆé»é€™è£¡å¯é—œé–‰èŠ±ç“£é–ƒçˆæ•ˆæœï¼‰
  </small>
</h2>
    <div class="nav-grid">
      <div class="nav-item full" data-petal="0">
        <strong>1) Learn 5 Sentence Structures</strong><br>
      </div>
      <div class="nav-item" data-petal="1"><strong>2) Learn Simple Tenses</strong></div>
      <div class="nav-item" data-petal="2"><strong>3) Learn Progressive Tenses</strong></div>
      <div class="nav-item" data-petal="3"><strong>4) Learn Perfect Tenses</strong></div>
      <div class="nav-item" data-petal="4"><strong>5) Learn To do V.S. doing</strong></div>
      <div class="nav-item" data-petal="5"><strong>6) Learn V-ing V.S. V-ed</strong></div>
      <div class="nav-item" data-petal="6"><strong>7) Learn Noun Clauses</strong></div>
      <div class="nav-item" data-petal="7"><strong>8) Learn Adjective Clauses</strong></div>
      <div class="nav-item" data-petal="8"><strong>9) Learn Adverb Clauses</strong></div>
      <div class="nav-item" data-petal="9"><strong>10) Learn Inverted Sentences</strong></div>
      <div class="nav-item" data-petal="10"><strong>11) Learn Subjunctive Mood</strong></div>
    </div>
  </section>

  <div id="flower-rotator" aria-hidden="false">
    <div id="petal-container" role="navigation" aria-label="AI å­¸ç¿’æ¨‚ğŸµåœ’ 11å€‹æ–‡æ³•å­¸ç¿’å…¥å£">

      <a class="petal layer-a" style="--angle:-65.45deg; --tilt:-4deg"
         href="https://ducj-creator.github.io/Shirley-AI-Music-Studio/learning/track%201.html"
         target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn 5 Sentence Structures</strong></div>
      </a>

      <a class="petal layer-b" style="--angle:-32.73deg; --tilt:2deg" href="#" target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn Simple Tenses</strong></div>
      </a>

      <a class="petal layer-a" style="--angle:0deg; --tilt:-3deg" href="#" target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn Progressive Tenses</strong></div>
      </a>

      <a class="petal layer-b" style="--angle:32.73deg; --tilt:3deg" href="#" target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn Perfect Tenses</strong></div>
      </a>

      <a class="petal layer-a" style="--angle:65.45deg; --tilt:-2deg" href="#" target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn To do V.S. doing</strong></div>
      </a>

      <a class="petal layer-b" style="--angle:98.18deg; --tilt:4deg" href="#" target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn V-ing V.S. V-ed</strong></div>
      </a>

      <a class="petal layer-a" style="--angle:130.91deg; --tilt:-4deg" href="#" target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn Noun Clauses</strong></div>
      </a>

      <a class="petal layer-b" style="--angle:163.64deg; --tilt:2deg" href="#" target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn Adjective Clauses</strong></div>
      </a>

      <a class="petal layer-a" style="--angle:196.36deg; --tilt:-3deg" href="#" target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn Adverb Clauses</strong></div>
      </a>

      <a class="petal layer-b" style="--angle:229.09deg; --tilt:3deg" href="#" target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn Inverted Sentences</strong></div>
      </a>

      <a class="petal layer-a" style="--angle:261.82deg; --tilt:-2deg" href="#" target="_blank" rel="noopener">
        <div class="petal-content"><strong>Learn Subjunctive Mood</strong></div>
      </a>

      <div id="learning-center" aria-hidden="true">
        AI å”±æ­ŒğŸµï¼Œ<br>å­¸æ–‡æ³•ï¼
      </div>
    </div>
  </div>

  <button id="back-button" onclick="window.location.href='https://ducj-creator.github.io/Shirley-AI-Music-Studio/'">
    è¿”å›ä¸»é 
  </button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <script>
    /* ================================== */
    /* âœ… æ–°å¢ï¼šèŠ±æœµè¦–çª—é©é…åŠŸèƒ½ */
    /* ================================== */
    let resizeTimeout;
    
    function calculateFlowerSize() {
      const viewportHeight = window.innerHeight;
      const viewportWidth = window.innerWidth;
      
      // è¨ˆç®—å¯ç”¨ç©ºé–“
      const header = document.getElementById('page-title');
      const nav = document.getElementById('nav-panel');
      const button = document.getElementById('back-button');
      
      const headerHeight = header ? header.offsetHeight : 0;
      const navHeight = nav ? nav.offsetHeight : 0;
      const buttonHeight = button ? button.offsetHeight : 0;
      
      // è¨ˆç®—å¯ç”¨é«˜åº¦
      const pagePadding = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--page-padding')) || 20;
      const totalVerticalSpace = headerHeight + navHeight + buttonHeight + (pagePadding * 3) + 60; // ç·©è¡å€
      const availableHeight = viewportHeight - totalVerticalSpace;
      
      // è¨ˆç®—å¯ç”¨å¯¬åº¦
      const availableWidth = viewportWidth - (pagePadding * 2);
      
      // ä½¿ç”¨è¼ƒå°å€¼ä½œç‚ºé™åˆ¶
      const maxSize = Math.min(availableHeight, availableWidth, 650);
      
      // ç¢ºä¿æœ€å°å€¼
      const minSize = Math.min(viewportHeight * 0.4, viewportWidth * 0.8, 300);
      const finalSize = Math.max(minSize, maxSize);
      
      return {
        size: finalSize,
        petalW: Math.max(80, finalSize * 0.24),
        petalH: Math.max(110, finalSize * 0.34),
        centerSize: Math.max(60, finalSize * 0.17),
        lift: Math.max(15, finalSize * 0.1)
      };
    }
    
    function adjustFlowerForViewport() {
      const flower = document.getElementById('flower-rotator');
      if (!flower) return;
      
      const sizes = calculateFlowerSize();
      
      // å‹•æ…‹è¨­ç½®å®¹å™¨å¤§å°
      flower.style.width = `${sizes.size}px`;
      flower.style.height = `${sizes.size}px`;
      
      // æ›´æ–° CSS è®Šæ•¸
      document.documentElement.style.setProperty('--container-size', `${sizes.size}px`);
      document.documentElement.style.setProperty('--petal-w', `${sizes.petalW}px`);
      document.documentElement.style.setProperty('--petal-h', `${sizes.petalH}px`);
      document.documentElement.style.setProperty('--center-size', `${sizes.centerSize}px`);
      document.documentElement.style.setProperty('--lift', `${sizes.lift}px`);
      
      // æ›´æ–°ä¸­å¿ƒåœ“å­—é«”å¤§å°
      const center = document.getElementById('learning-center');
      if (center) {
        const fontSize = Math.max(12, sizes.centerSize * 0.1);
        center.style.fontSize = `${fontSize}px`;
      }
    }
    
    function debounceAdjustFlower() {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(adjustFlowerForViewport, 250);
    }
    
    // åˆå§‹èª¿æ•´
    window.addEventListener('load', () => {
      setTimeout(adjustFlowerForViewport, 100);
    });
    
    // è¦–çª—å¤§å°æ”¹è®Šæ™‚é‡æ–°èª¿æ•´
    window.addEventListener('resize', debounceAdjustFlower);
    
    // ç›£è½æ»¾è¼ªäº‹ä»¶ï¼Œåœ¨ç¸®æ”¾æ™‚ä¹Ÿèª¿æ•´
    window.addEventListener('wheel', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(adjustFlowerForViewport, 500);
    });

    /* ---------------------------------- */
    /* Three.js æµ©ç€šæ˜Ÿç³»ç²’å­èƒŒæ™¯ (å·²ç§»é™¤æ»‘é¼ æ’æ–¥åŠ›ï¼Œæ”¹ç‚ºæ”¯æ´æ»¾è¼ª/è§¸æ§ç¸®æ”¾) */
    /* ---------------------------------- */
    // æ ¹æ“šè£ç½®æ•ˆèƒ½å‹•æ…‹èª¿æ•´ç²’å­æ•¸é‡
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const isLowPower = navigator.hardwareConcurrency && navigator.hardwareConcurrency < 4;
    
    // å‹•æ…‹èª¿æ•´ç²’å­æ•¸é‡ï¼šé«˜æ•ˆèƒ½è£ç½® 8000ï¼Œä¸€èˆ¬è£ç½® 5000ï¼Œä½æ•ˆèƒ½è£ç½® 3000
    let NUM_PARTICLES = 5000;
    if (isMobile || isLowPower) {
      NUM_PARTICLES = 3000;
    } else if (navigator.hardwareConcurrency && navigator.hardwareConcurrency >= 8) {
      NUM_PARTICLES = 8000;
    }
    
    const GALAXY_RADIUS = 150;
    const BASE_COLOR = new THREE.Color(0x44aaff);
    const MAX_PARTICLE_SIZE = 0.8;
    const ZOOM_MIN = 50;
    const ZOOM_MAX = 600;

    // --- Three.js æ ¸å¿ƒè®Šæ•¸ ---
    let scene, camera, renderer;
    let particles, positions, basePositions;
    let time = 0;
    
    // æ•ˆèƒ½æ§åˆ¶è®Šæ•¸
    let isPageVisible = true;
    let animationFrameId = null;
    let lastRenderTime = 0;
    let TARGET_FPS = 30; // é™ä½ç›®æ¨™å¹€ç‡
    const FRAME_INTERVAL = 1000 / TARGET_FPS;

    function initGalaxy() {
      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 300;

      renderer = new THREE.WebGLRenderer({ 
        antialias: true, 
        alpha: true,
        powerPreference: 'low-power' // çœé›»æ¨¡å¼
      });
      
      // æ ¹æ“šè£ç½®èª¿æ•´ç•«è³ª
      const pixelRatio = isMobile ? 1 : window.devicePixelRatio || 1;
      renderer.setPixelRatio(Math.min(pixelRatio, 1.5)); // é™åˆ¶æœ€é«˜ç•«è³ª
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.domElement.id = "stars-bg";
      document.body.appendChild(renderer.domElement);

      createParticlesGalaxy();

      // é é¢å¯è¦‹æ€§ç›£è½
      document.addEventListener('visibilitychange', () => {
        isPageVisible = !document.hidden;
        if (!isPageVisible) {
          cancelAnimationFrame(animationFrameId);
        } else {
          animateGalaxy();
        }
      });

      window.addEventListener('resize', onWindowResizeGalaxy, false);
    }

   function createParticlesGalaxy() {
  const geometry = new THREE.BufferGeometry();
  
  positions = new Float32Array(NUM_PARTICLES * 3);
  basePositions = new Float32Array(NUM_PARTICLES * 3);
  
  const sizes = new Float32Array(NUM_PARTICLES);

  for (let i = 0; i < NUM_PARTICLES; i++) {
    const i3 = i * 3;

    let x = (Math.random() - 0.5) * GALAXY_RADIUS * 2.5; 
    let y = (Math.random() - 0.5) * GALAXY_RADIUS * 2.5; 
    let z = (Math.random() - 0.5) * GALAXY_RADIUS * 2.5;
    
    const distance = Math.sqrt(x * x + y * y + z * z);
    if (distance > GALAXY_RADIUS) {
      x *= (GALAXY_RADIUS / distance);
      y *= (GALAXY_RADIUS / distance);
      z *= (GALAXY_RADIUS / distance);
    }

    positions[i3] = x;
    positions[i3 + 1] = y;
    positions[i3 + 2] = z;

    basePositions[i3] = x;
    basePositions[i3 + 1] = y;
    basePositions[i3 + 2] = z;

    sizes[i] = Math.random() * MAX_PARTICLE_SIZE + 0.2;
  }

  geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

  const material = new THREE.PointsMaterial({
    color: BASE_COLOR,
    size: MAX_PARTICLE_SIZE,
    sizeAttenuation: true,
    transparent: true,
    opacity: 1.0,
    blending: THREE.AdditiveBlending
  });

  particles = new THREE.Points(geometry, material);
  scene.add(particles);
  
  const ambientLight = new THREE.AmbientLight(0x404040, 5);
  scene.add(ambientLight);
}

// å„ªåŒ–ç²’å­æ›´æ–°å‡½æ•¸ï¼Œæ¸›å°‘è¨ˆç®—é‡
function updateParticlesGalaxy() {
  if (!particles) return;

  time += 0.002; // æ¸›æ…¢å‹•ç•«é€Ÿåº¦
  
  const p_positions = particles.geometry.attributes.position.array;
  const skipFactor = isMobile ? 3 : 2; // ä½æ•ˆèƒ½è£ç½®è·³éæ›´å¤šç²’å­è¨ˆç®—

  for (let i = 0; i < NUM_PARTICLES; i += skipFactor) {
    const i3 = i * 3;
    
    const bx = basePositions[i3];
    const by = basePositions[i3 + 1];
    const bz = basePositions[i3 + 2];
    
    const r = Math.sqrt(bx * bx + bz * bz);
    const baseAngle = Math.atan2(bz, bx);
    const angle = baseAngle + time * 0.1; // æ¸›æ…¢æ—‹è½‰é€Ÿåº¦
    
    const x = Math.cos(angle) * r;
    const z = Math.sin(angle) * r;
    const y = by + Math.sin(time * 0.5 + i * 0.005) * 0.8; // æ¸›å°ç§»å‹•å¹…åº¦
    
    p_positions[i3] = x;
    p_positions[i3 + 1] = y;
    p_positions[i3 + 2] = z;
  }
  
  particles.geometry.attributes.position.needsUpdate = true;
}

// é™åˆ¶å¹€ç‡çš„å‹•ç•«å‡½æ•¸
function animateGalaxy(currentTime) {
  animationFrameId = requestAnimationFrame(animateGalaxy);
  
  if (!isPageVisible) return;
  
  // é™åˆ¶å¹€ç‡
  if (currentTime - lastRenderTime < FRAME_INTERVAL) {
    return;
  }
  lastRenderTime = currentTime;
  
  updateParticlesGalaxy();
  renderer.render(scene, camera);
}

    function onWindowResizeGalaxy() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    initGalaxy();
    animateGalaxy();

    /* ================================== */
    /* âœ… æ–°å¢ï¼šæ»¾è¼ªèˆ‡è§¸æ§ç¸®æ”¾åŠŸèƒ½ */
    /* ================================== */

    // 1. æ»‘é¼ æ»¾è¼ªç¸®æ”¾ (Mouse Wheel Zoom)
    function onDocumentMouseWheel(event) {
        event.preventDefault();

        camera.position.z += event.deltaY * 0.08;
        camera.position.z = Math.max(ZOOM_MIN, Math.min(ZOOM_MAX, camera.position.z));
    }
    window.addEventListener('wheel', onDocumentMouseWheel, { passive: false });

    // 2. è§¸æ§æåˆç¸®æ”¾ (Pinch-to-Zoom)
    let touchDistance = 0;

    function getTouchDistance(touch1, touch2) {
        const dx = touch1.clientX - touch2.clientX;
        const dy = touch1.clientY - touch2.clientY;
        return Math.sqrt(dx * dx + dy * dy);
    }
    
    function onTouchStart(event) {
        if (event.touches.length === 2) {
            touchDistance = getTouchDistance(event.touches[0], event.touches[1]);
        }
    }

    function onTouchMove(event) {
        if (event.touches.length === 2) {
            event.preventDefault();

            const newDistance = getTouchDistance(event.touches[0], event.touches[1]);
            const delta = newDistance - touchDistance;
            
            camera.position.z -= delta * 0.5;
            camera.position.z = Math.max(ZOOM_MIN, Math.min(ZOOM_MAX, camera.position.z));
            
            touchDistance = newDistance;
            camera.updateProjectionMatrix();
        }
    }
    
    window.addEventListener('touchstart', onTouchStart, { passive: false });
    window.addEventListener('touchmove', onTouchMove, { passive: false });

  </script>

  <script>
    /* ---------------------------------- */
    /* Golden Trail â€” å„ªåŒ–ç‰ˆ */
    /* ---------------------------------- */
    const canvas = document.getElementById('trail-canvas');
    const ctx = canvas.getContext('2d');

    let w, h, dpr;
    function resize(){
      dpr = window.devicePixelRatio || 1;
      w = window.innerWidth;
      h = window.innerHeight;
      canvas.width = w * dpr;
      canvas.height = h * dpr;
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    resize();
    window.addEventListener('resize', resize);

    const points = [];
    const MAX_POINTS = 30; // æ¸›å°‘é»æ•¸

    window.addEventListener('mousemove', (e) => {
      points.push({ x: e.clientX, y: e.clientY, life: 1 });
      if(points.length > MAX_POINTS) points.shift();
    });

    // è»Œè·¡ç¹ªè£½æ•ˆèƒ½å„ªåŒ–
    let lastTrailTime = 0;
    const TRAIL_INTERVAL = 1000 / 20; // é™ä½åˆ° 20 FPS

    function draw(currentTime) {
      requestAnimationFrame(draw);
      
      if (currentTime - lastTrailTime < TRAIL_INTERVAL) {
        return;
      }
      lastTrailTime = currentTime;
      
      ctx.clearRect(0,0,w,h);

      for(let i=0;i<points.length;i++){
        points[i].life -= 0.015;
      }

      // åªç¹ªè£½æœ‰ç”Ÿå‘½å€¼çš„é»
      const validPoints = points.filter(p => p.life > 0);
      
      for(let i=1;i<validPoints.length;i++){
        const p0 = validPoints[i-1];
        const p1 = validPoints[i];
        
        const alpha = Math.max(0, p1.life);
        const lw = 6 * alpha + 1; // æ¸›å°‘ç·šå¯¬

        const grad = ctx.createLinearGradient(p0.x,p0.y,p1.x,p1.y);
        grad.addColorStop(0, `rgba(255,180,0,0)`);
        grad.addColorStop(0.5, `rgba(255,211,107,${0.85*alpha})`);
        grad.addColorStop(1, `rgba(255,243,200,${0.6*alpha})`);

        ctx.strokeStyle = grad;
        ctx.lineWidth = lw;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(p0.x,p0.y);
        ctx.lineTo(p1.x,p1.y);
        ctx.stroke();

        if(i === validPoints.length-1){
          ctx.fillStyle = `rgba(255,211,107,${alpha})`;
          ctx.beginPath();
          ctx.arc(p1.x,p1.y, 4.5*alpha, 0, Math.PI*2);
          ctx.fill();
        }
      }

      while(points.length && points[0].life <= 0) points.shift();
    }
    draw();

    /* ---------------------------------- */
   const navItems = document.querySelectorAll('#nav-panel .nav-item');
const petals = document.querySelectorAll('#petal-container .petal');

navItems.forEach(item => {
  const index = item.getAttribute('data-petal');
  if (index === null) return;

  item.addEventListener('click', () => {
    const i = parseInt(index, 10);
    if (!petals[i]) return;

    petals.forEach(p => p.classList.remove('nav-highlight'));

    const petal = petals[i];
    void petal.offsetWidth;
    petal.classList.add('nav-highlight');
  });
});

// é»ã€ŒKnowledge Map Â· æ–‡æ³•èŠ±åœ’å°è¦½ã€æ¨™é¡Œæ™‚ï¼ŒæŠŠæ‰€æœ‰é–ƒçˆé—œæ‰
const navTitle = document.querySelector('.nav-title');
if (navTitle) {
  navTitle.addEventListener('click', () => {
    petals.forEach(p => p.classList.remove('nav-highlight'));
  });
}
  </script>

  <script>
    const bgm = document.getElementById('bgm');
    const audioControl = document.getElementById('audio-control');
    const volumeIcon = 'ğŸµ';
    const mutedIcon = 'ğŸ”‡';
    let isMuted = false;

    function attemptPlay() {
      bgm.volume = 0.2;
      
      const playPromise = bgm.play();

      if (playPromise !== undefined) {
        playPromise.catch(error => {
          console.log("Audio autoplay prevented. Waiting for user interaction.");
          bgm.muted = true;
          isMuted = true;
          audioControl.innerHTML = mutedIcon;
        });
      }
    }

    function toggleMute() {
      if (bgm.muted) {
        bgm.muted = false;
        isMuted = false;
        audioControl.innerHTML = volumeIcon;
        
        if (bgm.paused) {
             const playPromise = bgm.play();
             if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.error("Manual play failed after unmute:", error);
                });
            }
        }
      } else {
        bgm.muted = true;
        isMuted = true;
        audioControl.innerHTML = mutedIcon;
      }
    }
    
    audioControl.addEventListener('click', toggleMute);

    window.onload = attemptPlay;
    
    bgm.addEventListener('play', () => {
        if (!bgm.muted) {
            audioControl.innerHTML = volumeIcon;
        }
    });

  </script>

  <script>
    /* ---------------------------------- */
    /* æ•ˆèƒ½æ§åˆ¶åŠŸèƒ½ */
    /* ---------------------------------- */
    const performanceControl = document.getElementById('performance-control');
    let isAnimationsPaused = false;
    let originalSparksState = [];

    // å„²åŸå§‹ç«èŠ±å‹•ç•«ç‹€æ…‹
    document.querySelectorAll('.spark').forEach(spark => {
      originalSparksState.push({
        element: spark,
        animation: spark.style.animation,
        opacity: spark.style.opacity
      });
    });

    function pauseAnimations() {
      // æš«åœ Three.js å‹•ç•«
      cancelAnimationFrame(animationFrameId);
      
      // æš«åœç«èŠ±å‹•ç•«
      document.querySelectorAll('.spark').forEach(spark => {
        spark.style.animationPlayState = 'paused';
      });
      
      // æš«åœ CSS å‹•ç•«
      document.querySelectorAll('*').forEach(element => {
        const computedStyle = window.getComputedStyle(element);
        if (computedStyle.animationName !== 'none') {
          element.style.animationPlayState = 'paused';
        }
      });
      
      // é™ä½ç²’å­æ›´æ–°é »ç‡
      TARGET_FPS = 15;
      
      performanceControl.innerHTML = 'â–¶';
      performanceControl.setAttribute('data-paused', 'true');
      isAnimationsPaused = true;
    }

    function resumeAnimations() {
      // æ¢å¾© Three.js å‹•ç•«
      animateGalaxy();
      
      // æ¢å¾©ç«èŠ±å‹•ç•«
      document.querySelectorAll('.spark').forEach(spark => {
        spark.style.animationPlayState = 'running';
      });
      
      // æ¢å¾© CSS å‹•ç•«
      document.querySelectorAll('*').forEach(element => {
        const computedStyle = window.getComputedStyle(element);
        if (computedStyle.animationName !== 'none') {
          element.style.animationPlayState = 'running';
        }
      });
      
      // æ¢å¾©æ­£å¸¸å¹€ç‡
      TARGET_FPS = 30;
      
      performanceControl.innerHTML = 'âš¡';
      performanceControl.setAttribute('data-paused', 'false');
      isAnimationsPaused = false;
    }

    performanceControl.addEventListener('click', () => {
      if (isAnimationsPaused) {
        resumeAnimations();
      } else {
        pauseAnimations();
      }
    });

    // è£ç½®æ•ˆèƒ½è‡ªå‹•èª¿æ•´
    if (isMobile || isLowPower) {
      // ç§»é™¤æˆ–ç°¡åŒ–ç«èŠ±å‹•ç•«
      document.querySelectorAll('.spark').forEach(spark => {
        spark.style.opacity = '0.3';
        spark.style.animationDuration = '20s'; // æ¸›æ…¢é€Ÿåº¦
      });
      
      // é™ä½èƒŒæ™¯å‹•ç•«è¤‡é›œåº¦
      document.body.style.animation = 'none';
      
      // è‡ªå‹•å•Ÿç”¨æ•ˆèƒ½æ¨¡å¼
      setTimeout(() => {
        if (performanceWarning) {
          pauseAnimations();
        }
      }, 5000);
    }

    // æ•ˆèƒ½ç›£æ§
    let frameCount = 0;
    let lastCheckTime = 0;
    let performanceWarning = false;

    function checkPerformance(currentTime) {
      frameCount++;
      
      if (currentTime - lastCheckTime > 1000) {
        const fps = frameCount;
        frameCount = 0;
        lastCheckTime = currentTime;
        
        if (fps < 20 && !performanceWarning && !isAnimationsPaused) {
          performanceWarning = true;
          console.log('Low performance detected, reducing effects');
          
          // è‡ªå‹•åˆ‡æ›åˆ°æ•ˆèƒ½æ¨¡å¼
          pauseAnimations();
        } else if (fps > 30 && performanceWarning && isAnimationsPaused) {
          performanceWarning = false;
          console.log('Performance improved, restoring effects');
          
          // æ¢å¾©å‹•ç•«
          resumeAnimations();
        }
      }
      
      requestAnimationFrame(checkPerformance);
    }

    // é–‹å§‹æ•ˆèƒ½ç›£æ§
    requestAnimationFrame(checkPerformance);
  </script>
</body>
</html>
